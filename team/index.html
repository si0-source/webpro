<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>질문 테스트</title>
    <meta name="description" content="몇 가지 질문에 답하고 맞춤형 결과를 받아보세요" />
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/framer-motion@11/dist/framer-motion.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* 배경 색상 변수 추가 */
        :root {
            /* 기본 배경: 아주 연한 푸른 보라 */
            --background: 240 20% 97%; 
            /* 간편 모드 활성화 시 배경: 연한 보라 */
            --background-simple: 240 40% 95%; 
            --foreground: 260 70% 12%; /* 진한 보라색 텍스트 */
            --card: 0 0% 100%;
            --card-foreground: 260 70% 12%;
            /* Primary: 연한 보라색 */
            --primary: 260 60% 70%; 
            --primary-foreground: 0 0% 100%;
            --secondary: 240 15% 92%; /* 아주 연한 보라/회색 */
            --secondary-foreground: 260 70% 12%;
            --muted: 240 15% 94%;
            --muted-foreground: 240 20% 45%;
            /* Accent: Primary보다 약간 진한 보라색 */
            --accent: 240 60% 65%; 
            --accent-foreground: 0 0% 100%;
            --border: 240 15% 90%;
            --radius: 0.75rem;
            --gradient-primary: hsl(var(--primary));
            --shadow-card: 0 10px 40px -8px hsl(240 30% 60% / 0.15); /* 보라색 계열 그림자 */
        }

        /* 간편 답변 모드 활성화 시 배경색 동적 변경을 위한 클래스 */
        .simple-mode-active {
            background: hsl(var(--background-simple)) !important;
            transition: background 0.5s ease-in-out;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            transition: background 0.5s ease-in-out;
        }
        
        /* 토글 스위치 스타일 (레버 모양 강조) */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 56px; 
            height: 32px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: hsl(var(--muted));
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: hsl(var(--primary));
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(var(--background))',
                        'background-simple': 'hsl(var(--background-simple))',
                        foreground: 'hsl(var(--foreground))',
                        card: 'hsl(var(--card))',
                        'card-foreground': 'hsl(var(--card-foreground))',
                        primary: 'hsl(var(--primary))',
                        'primary-foreground': 'hsl(var(--primary-foreground))',
                        secondary: 'hsl(var(--secondary))',
                        'secondary-foreground': 'hsl(var(--secondary-foreground))',
                        muted: 'hsl(var(--muted))',
                        'muted-foreground': 'hsl(var(--muted-foreground))',
                        accent: 'hsl(var(--accent))',
                        'accent-foreground': 'hsl(var(--accent-foreground))',
                        border: 'hsl(var(--border))',
                        // 간편 모드 활성화 시 버튼 색상 변수 추가 (연한 보라)
                        'simple-primary': 'hsl(240 40% 75%)', 
                        'simple-foreground': 'hsl(260 70% 12%)',
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = Motion;

        // E: Action/Extrovert (행동/외향)
        // F: Empathy/Feeling (공감/관계)
        // T: Logic/Thinking (논리/분석)
        // P: Planning/Judging (계획/체계)

        // --- 수정된 질문 목록 (모든 옵션에 성격 태그 부여) ---
        const questionPool = {
            // 모든 연령 공통 질문 (MBTI, 성향 분석에 도움)
            COMMON: [
                { question: "아침에 일어났을 때 가장 먼저 하는 일은?", options: [
                    { text: "SNS 확인", tag: "E" }, // 외부 활동/관심
                    { text: "스트레칭", tag: "E" }, // 즉각적 행동
                    { text: "물 마시기", tag: "T" }, // 건강/효율
                    { text: "침대에서 5분 더", tag: "F" } // 내향/휴식
                ] },
                { question: "주말 아침, 이상적인 시간은?", options: [
                    { text: "7시 이전", tag: "P" }, // 계획/규칙
                    { text: "8-9시", tag: "T" }, // 효율적 시작
                    { text: "10-11시", tag: "E" }, // 여유/활동
                    { text: "정오 이후", tag: "F" } // 자유/휴식
                ] },
                { question: "여행 계획을 세울 때 당신은?", options: [
                    { text: "세세한 일정표 작성", tag: "P" },
                    { text: "큰 틀만 정함", tag: "T" },
                    { text: "즉흥적으로", tag: "E" },
                    { text: "다른 사람 따라감", tag: "F" } // 관계 지향
                ] },
                { question: "친구가 고민 상담을 한다면?", options: [
                    { text: "해결책 제시", tag: "T" },
                    { text: "공감하며 들어줌", tag: "F" },
                    { text: "경험담 공유", tag: "E" },
                    { text: "같이 고민", tag: "F" }
                ] },
                { question: "새로운 취미를 시작한다면?", options: [
                    { text: "운동", tag: "E" },
                    { text: "예술/공예", tag: "F" },
                    { text: "요리", tag: "P" }, // 기술/목표
                    { text: "독서", tag: "T" } // 지식/분석
                ] },
                { question: "스트레스 해소 방법은?", options: [
                    { text: "운동", tag: "E" },
                    { text: "음악 감상", tag: "F" },
                    { text: "잠", tag: "P" }, // 재충전/회복
                    { text: "쇼핑", tag: "E" }
                ] },
                { question: "선호하는 영화 장르는?", options: [
                    { text: "액션", tag: "E" },
                    { text: "로맨스", tag: "F" },
                    { text: "스릴러", tag: "T" }, // 분석/추리
                    { text: "코미디", tag: "F" }
                ] },
                { question: "카페에서 주로 주문하는 것은?", options: [
                    { text: "아메리카노", tag: "T" }, // 효율/기본
                    { text: "라떼", tag: "F" },
                    { text: "차", tag: "P" }, // 신중
                    { text: "디저트 중심", tag: "E" } // 충동/즐거움
                ] },
                { question: "회의 중 당신의 역할은?", options: [
                    { text: "리더", tag: "E" },
                    { text: "아이디어 제공", tag: "T" },
                    { text: "경청", tag: "F" },
                    { text: "기록", tag: "P" }
                ] },
                { question: "갑자기 생긴 자유 시간, 무엇을 할까?", options: [
                    { text: "계획했던 일", tag: "P" },
                    { text: "휴식", tag: "F" },
                    { text: "친구 만남", tag: "E" },
                    { text: "새로운 것 시도", tag: "E" }
                ] },
                { question: "선물을 고를 때 중요한 것은?", options: [
                    { text: "실용성", tag: "T" },
                    { text: "디자인", tag: "E" },
                    { text: "가격", tag: "P" }, // 예산/관리
                    { text: "의미", tag: "F" }
                ] },
                { question: "좋아하는 계절은?", options: [
                    { text: "봄", tag: "F" },
                    { text: "여름", tag: "E" },
                    { text: "가을", tag: "T" }, // 명확/성숙
                    { text: "겨울", tag: "P" } // 정리/안정
                ] },
                { question: "SNS 사용 패턴은?", options: [
                    { text: "자주 올림", tag: "E" },
                    { text: "보기만 함", tag: "F" },
                    { text: "가끔 올림", tag: "T" },
                    { text: "거의 안함", tag: "P" }
                ] },
                { question: "음악을 들을 때 선호하는 방식은?", options: [
                    { text: "플레이리스트", tag: "P" },
                    { text: "랜덤", tag: "E" },
                    { text: "앨범 전체", tag: "T" }, // 분석
                    { text: "라디오", tag: "F" } // 관계/소통
                ] },
                { question: "책을 읽을 때 선호하는 장르는?", options: [
                    { text: "소설", tag: "F" },
                    { text: "자기계발", tag: "T" },
                    { text: "에세이", tag: "P" }, // 사색
                    { text: "전문서적", tag: "T" }
                ] },
                { question: "새로운 사람을 만날 때?", options: [
                    { text: "적극적으로 다가감", tag: "E" },
                    { text: "상대 반응 보고", tag: "F" },
                    { text: "소극적", tag: "P" },
                    { text: "피함", tag: "T" } // 효율/불필요
                ] },
                { question: "선호하는 운동 방식은?", options: [
                    { text: "혼자 조깅", tag: "P" },
                    { text: "팀 스포츠", tag: "E" },
                    { text: "헬스", tag: "T" }, // 목표/효율
                    { text: "운동 안함", tag: "F" }
                ] },
                { question: "패션 스타일은?", options: [
                    { text: "미니멀", tag: "T" },
                    { text: "트렌디", tag: "E" },
                    { text: "편안함 우선", tag: "F" },
                    { text: "개성 있게", tag: "E" }
                ] },
                { question: "논쟁 상황에서 당신은?", options: [
                    { text: "논리적 설득", tag: "T" },
                    { text: "감정 호소", tag: "F" },
                    { text: "회피", tag: "P" },
                    { text: "중재", tag: "F" }
                ] },
                { question: "실패했을 때 반응은?", options: [
                    { text: "원인 분석", tag: "T" },
                    { text: "감정 토로", tag: "F" },
                    { text: "빨리 잊음", tag: "E" },
                    { text: "다시 도전", tag: "E" }
                ] },
                { question: "좋아하는 색상은?", options: [
                    { text: "파랑", tag: "T" },
                    { text: "빨강", tag: "E" },
                    { text: "초록", tag: "F" },
                    { text: "노랑", tag: "E" }
                ] },
                { question: "아침 식사 스타일은?", options: [
                    { text: "든든하게", tag: "P" },
                    { text: "간단하게", tag: "T" },
                    { text: "커피만", tag: "E" },
                    { text: "안먹음", tag: "F" }
                ] },
                { question: "전화와 문자 중 선호는?", options: [
                    { text: "전화", tag: "E" },
                    { text: "문자", tag: "T" },
                    { text: "상황따라", tag: "P" },
                    { text: "둘 다 싫음", tag: "F" }
                ] },
                { question: "집 인테리어 스타일은?", options: [
                    { text: "모던", tag: "T" },
                    { text: "빈티지", tag: "F" },
                    { text: "미니멀", tag: "P" },
                    { text: "아늑함", tag: "F" }
                ] },
                { question: "파티에서 당신은?", options: [
                    { text: "분위기 주도", tag: "E" },
                    { text: "친한 사람과", tag: "F" },
                    { text: "조용히 관찰", tag: "P" },
                    { text: "일찍 퇴장", tag: "T" }
                ] },
                { question: "날씨가 좋은 주말엔?", options: [
                    { text: "야외 활동", tag: "E" },
                    { text: "집에서 휴식", tag: "F" },
                    { text: "카페", tag: "P" },
                    { text: "문화생활", tag: "T" }
                ] },
                { question: "좋아하는 간식은?", options: [
                    { text: "과자", tag: "E" },
                    { text: "과일", tag: "T" },
                    { text: "견과류", tag: "P" },
                    { text: "안먹음", tag: "T" }
                ] },
                { question: "정보 습득 방법은?", options: [
                    { text: "책", tag: "P" },
                    { text: "영상", tag: "E" },
                    { text: "팟캐스트", tag: "F" },
                    { text: "경험", tag: "T" }
                ] },
                { question: "잠들기 전 루틴은?", options: [
                    { text: "독서", tag: "P" },
                    { text: "영상 시청", tag: "E" },
                    { text: "명상", tag: "F" },
                    { text: "스마트폰", tag: "E" }
                ] },
                { question: "에너지 충전 방법은?", options: [
                    { text: "사람들과", tag: "E" },
                    { text: "혼자", tag: "P" },
                    { text: "활동적으로", tag: "E" },
                    { text: "휴식", tag: "F" }
                ] }
            ],
            // 10대 (학교/진로)
            SCHOOL: [
                { question: "선호하는 학습 방식은?", options: [
                    { text: "이론 먼저", tag: "P" },
                    { text: "실습 중심", tag: "E" },
                    { text: "토론", tag: "F" },
                    { text: "독학", tag: "T" }
                ] },
                { question: "시험 전날 당신은?", options: [
                    { text: "밤샘 공부", tag: "E" },
                    { text: "충분히 잠", tag: "F" },
                    { text: "벼락치기", tag: "E" },
                    { text: "이미 끝냄", tag: "P" }
                ] },
                { question: "성적을 받았을 때 반응은?", options: [
                    { text: "만족", tag: "P" },
                    { text: "더 열심히", tag: "T" },
                    { text: "친구와 비교", tag: "E" },
                    { text: "신경 안 씀", tag: "F" }
                ] },
                { question: "학교에서 가장 집중하는 활동은?", options: [
                    { text: "공부", tag: "T" },
                    { text: "동아리", tag: "E" },
                    { text: "친구 관계", tag: "F" },
                    { text: "취미", tag: "P" }
                ] },
                { question: "장래 희망을 생각할 때 중요한 것은?", options: [
                    { text: "수입", tag: "T" },
                    { text: "적성", tag: "F" },
                    { text: "사회적 가치", tag: "P" },
                    { text: "안정성", tag: "P" }
                ] },
                { question: "방학 때 가장 하고 싶은 활동은?", options: [
                    { text: "여행", tag: "E" },
                    { text: "집에서 휴식", tag: "F" },
                    { text: "알바/경력 쌓기", tag: "T" },
                    { text: "새로운 공부", tag: "P" }
                ] },
                { question: "친구에게 거짓말이 발각됐을 때 반응은?", options: [
                    { text: "바로 사과", tag: "F" },
                    { text: "변명 시도", tag: "E" },
                    { text: "침묵", tag: "P" },
                    { text: "농담으로 넘김", tag: "E" }
                ] },
                { question: "가장 재미있는 수업 유형은?", options: [
                    { text: "실험/실습", tag: "E" },
                    { text: "토론/발표", tag: "T" },
                    { text: "선생님 강의", tag: "P" },
                    { text: "자습 시간", tag: "F" }
                ] },
                { question: "용돈 기입장을 쓰는 편인가요?", options: [
                    { text: "매우 꼼꼼히", tag: "P" },
                    { text: "대충만", tag: "T" },
                    { text: "필요할 때만", tag: "T" },
                    { text: "전혀 안 씀", tag: "E" }
                ] },
                { question: "새로운 학용품을 보면?", options: [
                    { text: "구매한다", tag: "E" },
                    { text: "구경만 한다", tag: "F" },
                    { text: "필요할 때만 산다", tag: "T" },
                    { text: "선물받는다", tag: "F" }
                ] }
            ],
            // 20대 (진로/독립/여가)
            COLLEGE_EARLY_CAREER: [
                { question: "협업 시 당신이 가장 중요시하는 역할은?", options: [
                    { text: "목표 설정", tag: "P" },
                    { text: "세부 실행", tag: "T" },
                    { text: "팀원 조율", tag: "F" },
                    { text: "결과 검토", tag: "T" }
                ] },
                { question: "현재 목표를 이루는 데 가장 필요한 것은?", options: [
                    { text: "자금", tag: "T" },
                    { text: "시간", tag: "P" },
                    { text: "경험", tag: "E" },
                    { text: "멘토", tag: "F" }
                ] },
                { question: "경제적 독립에 대한 당신의 생각은?", options: [
                    { text: "매우 중요", tag: "T" },
                    { text: "점진적으로", tag: "P" },
                    { text: "아직은 아님", tag: "F" },
                    { text: "크게 신경 안 씀", tag: "E" }
                ] },
                { question: "주요 역량을 키우는 방식은?", options: [
                    { text: "자격증/학위", tag: "T" },
                    { text: "실무 경험", tag: "E" },
                    { text: "스터디/강의", tag: "P" },
                    { text: "독학/실패 경험", tag: "T" }
                ] },
                { question: "일(활동)의 만족도를 결정하는 핵심 요소는?", options: [
                    { text: "결과물", tag: "T" },
                    { text: "과정의 즐거움", tag: "E" },
                    { text: "주변의 인정", tag: "F" },
                    { text: "금전적 보상", tag: "P" }
                ] },
                { question: "여가 시간을 활용하는 가장 큰 기준은?", options: [
                    { text: "효율적인 휴식", tag: "T" },
                    { text: "새로운 경험", tag: "E" },
                    { text: "취미 발전", tag: "P" },
                    { text: "친구와의 시간", tag: "F" }
                ] },
                { question: "인맥을 형성할 때 중요하게 생각하는 것은?", options: [
                    { text: "다양한 분야", tag: "E" },
                    { text: "깊은 관계", tag: "F" },
                    { text: "실용적인 도움", tag: "T" },
                    { text: "즐거움", tag: "F" }
                ] },
                { question: "돈을 쓸 때 가장 아깝지 않은 분야는?", options: [
                    { text: "자기계발", tag: "T" },
                    { text: "여행", tag: "E" },
                    { text: "맛집", tag: "F" },
                    { text: "패션/아이템", tag: "E" }
                ] },
                { question: "미래를 대비하는 방식은?", options: [
                    { text: "구체적 목표 설정", tag: "P" },
                    { text: "현재에 충실", tag: "E" },
                    { text: "유연성 확보", tag: "F" },
                    { text: "운명에 맡김", tag: "F" }
                ] },
                { question: "선호하는 주거 형태는?", options: [
                    { text: "원룸/오피스텔", tag: "T" },
                    { text: "쉐어하우스", tag: "E" },
                    { text: "부모님 댁", tag: "F" },
                    { text: "내 집 마련 준비", tag: "P" }
                ] }
            ],
            // 30대 이상 (직장/재테크/라이프스타일)
            CAREER_LIFESTYLE: [
                { question: "일을 처리하는 방식은?", options: [
                    { text: "마감 전 미리", tag: "P" },
                    { text: "마감 직전", tag: "E" },
                    { text: "조금씩 분산", tag: "T" },
                    { text: "몰아서", tag: "E" }
                ] },
                { question: "돈 관리 방식은?", options: [
                    { text: "꼼꼼히 기록", tag: "P" },
                    { text: "대략 파악", tag: "E" },
                    { text: "투자 우선", tag: "T" },
                    { text: "저축 우선", tag: "P" }
                ] },
                { question: "중요한 결정을 할 때?", options: [
                    { text: "분석 후 결정", tag: "T" },
                    { text: "직감", tag: "E" },
                    { text: "조언 구함", tag: "F" },
                    { text: "미룸", tag: "P" }
                ] },
                { question: "선호하는 여행 스타일은?", options: [
                    { text: "계획형 관광", tag: "P" },
                    { text: "자유여행", tag: "E" },
                    { text: "휴양", tag: "F" },
                    { text: "모험", tag: "E" }
                ] },
                { question: "집에서 보내는 시간?", options: [
                    { text: "생산적 활동", tag: "T" },
                    { text: "휴식/수면", tag: "F" },
                    { text: "취미", tag: "E" },
                    { text: "청소/정리", tag: "P" }
                ] },
                { question: "갈등 해결 방식은?", options: [
                    { text: "대화", tag: "F" },
                    { text: "시간이 해결", tag: "P" },
                    { text: "제3자 개입", tag: "E" },
                    { text: "회피", tag: "F" }
                ] },
                { question: "재테크에서 가장 중요하게 생각하는 것은?", options: [
                    { text: "수익률", tag: "T" },
                    { text: "안정성", tag: "P" },
                    { text: "정보의 접근성", tag: "E" },
                    { text: "타이밍", tag: "E" }
                ] },
                { question: "가장 선호하는 주거 형태는?", options: [
                    { text: "아파트", tag: "P" },
                    { text: "단독주택", tag: "F" },
                    { text: "오피스텔", tag: "T" },
                    { text: "상관없음", tag: "E" }
                ] },
                { question: "은퇴 후 이상적인 삶은?", options: [
                    { text: "여행", tag: "E" },
                    { text: "봉사", tag: "F" },
                    { text: "취미 활동", tag: "P" },
                    { text: "조용한 휴식", tag: "T" }
                ] },
                { question: "현재 가장 관심을 두는 자기계발 분야는?", options: [
                    { text: "직무 관련", tag: "T" },
                    { text: "외국어", tag: "P" },
                    { text: "재테크/투자", tag: "T" },
                    { text: "건강", tag: "F" }
                ] }
            ]
        };
        
        // --- 간편 답변 질문 세트 (2가지 선택지) ---
        // 간편 모드는 E/P, F/T의 대비되는 성향으로 구성
        const simpleQuestionPool = [
            { question: "새로운 아이디어를 얻을 때:", options: [
                { text: "직접 해보며 깨닫는다.", tag: "E" },
                { text: "깊이 생각하고 논리적으로 정리한다.", tag: "T" }
            ] },
            { question: "가장 편안한 상황은:", options: [
                { text: "많은 사람들과 에너지를 공유할 때.", tag: "E" },
                { text: "혼자 조용히 집중할 수 있을 때.", tag: "P" }
            ] },
            { question: "결정을 내릴 때 주로:", options: [
                { text: "상황의 이점과 논리적 결과를 고려한다.", tag: "T" },
                { text: "나와 타인의 감정과 가치를 중요시한다.", tag: "F" }
            ] },
            { question: "당신의 삶의 태도는:", options: [
                { text: "현재 순간을 즐기고 유연하게 대처한다.", tag: "E" },
                { text: "미래를 예측하고 계획에 따라 움직인다.", tag: "P" }
            ] },
            { question: "일을 시작할 때:", options: [
                { text: "큰 그림부터 구상하고 세부 사항은 나중에.", tag: "E" },
                { text: "세부 계획을 먼저 세우고 완벽하게 시작한다.", tag: "P" }
            ] },
            { question: "갈등 상황에서 당신은:", options: [
                { text: "직접 맞서서 해결하려 한다.", tag: "T" },
                { text: "갈등을 피하고 평화를 유지하려 한다.", tag: "F" }
            ] },
            { question: "새로운 기술을 배울 때:", options: [
                { text: "친구/동료와 함께 실험해 본다.", tag: "E" },
                { text: "관련 서적이나 매뉴얼을 탐독한다.", tag: "T" }
            ] },
            { question: "휴식을 취하는 방법은:", options: [
                { text: "활동적인 취미나 스포츠를 즐긴다.", tag: "E" },
                { text: "아무것도 하지 않고 재충전한다.", tag: "P" }
            ] },
            { question: "문제를 처리할 때:", options: [
                { text: "경험에 비추어 직관적으로 판단한다.", tag: "F" },
                { text: "데이터와 정보를 기반으로 분석한다.", tag: "T" }
            ] },
            { question: "시간 관리는:", options: [
                { text: "엄격한 시간표를 따르는 것에 익숙하다.", tag: "P" },
                { text: "자유롭게 일정을 조정하는 것을 선호한다.", tag: "E" }
            ] },
            { question: "다른 사람에게 도움을 요청하는 것:", options: [
                { text: "필요하다면 망설이지 않고 요청한다.", tag: "E" },
                { text: "가능한 한 혼자 해결하는 것이 편하다.", tag: "P" }
            ] },
            { question: "여행지 선택 시:", options: [
                { text: "새로운 곳에서 도전과 모험을 경험한다.", tag: "E" },
                { text: "친숙하고 편안한 곳에서 안정감을 찾는다.", tag: "F" }
            ] },
            { question: "인생의 중요한 목표는:", options: [
                { text: "개인의 성취와 성공을 이루는 것.", tag: "T" },
                { text: "주변 사람들과의 행복과 관계를 유지하는 것.", tag: "F" }
            ] },
            { question: "가장 중요한 자산은:", options: [
                { text: "물질적인 안정과 풍요로움.", tag: "P" },
                { text: "시간과 선택의 자유.", tag: "E" }
            ] },
            { question: "비판을 받아들일 때:", options: [
                { text: "비판의 내용과 논리를 중요하게 생각한다.", tag: "T" },
                { text: "비판하는 사람의 의도와 감정을 먼저 살핀다.", tag: "F" }
            ] },
        ];


        function getQuestionsByAge(age, count) {
            let coreQuestions = [];

            if (age < 20) {
                coreQuestions = questionPool.SCHOOL;
            } else if (age < 30) {
                coreQuestions = questionPool.COLLEGE_EARLY_CAREER;
            } else {
                coreQuestions = questionPool.CAREER_LIFESTYLE;
            }

            const getShuffled = (arr, num) => [...arr].sort(() => Math.random() - 0.5).slice(0, num);
            
            const commonCount = Math.floor(count / 2);
            const coreCount = count - commonCount;

            const selectedCommon = getShuffled(questionPool.COMMON, commonCount);
            const selectedCore = getShuffled(coreQuestions, coreCount);

            return [...selectedCommon, ...selectedCore].sort(() => Math.random() - 0.5);
        }

        function getSimpleQuestions(count) {
            const getShuffled = (arr, num) => [...arr].sort(() => Math.random() - 0.5).slice(0, num);
            return getShuffled(simpleQuestionPool, count);
        }
        
        // AgeInputScreen (코드 유지)
        function AgeInputScreen({ onAgeSubmit }) {
            
            const ageOptions = [
                { label: "10대 (10~19세)", value: 15, key: 10 },
                { label: "20대 (20~29세)", value: 25, key: 20 },
                { label: "30대 (30~39세)", value: 35, key: 30 },
                { label: "40대 이상", value: 45, key: 40 }, 
            ];

            const [selectedAge, setSelectedAge] = useState(null);

            const handleSubmit = () => {
                if (selectedAge) {
                    onAgeSubmit(selectedAge);
                }
            };
            
            return (
                <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    className="min-h-screen flex items-center justify-center p-8"
                    style={{ background: 'hsl(var(--background))' }}
                >
                    <div className="max-w-md w-full text-center text-foreground p-12 bg-card rounded-2xl shadow-2xl border border-border/50">
                        <motion.h1
                            initial={{ opacity: 0, y: -20 }}
                            animate={{ y: 0, opacity: 1 }}
                            transition={{ delay: 0.2 }}
                            className="text-4xl font-extrabold mb-8 text-primary" 
                        >
                            가까운 나이를 선택해주세요
                        </motion.h1>
                        
                        <div className="space-y-4 mb-8">
                            {ageOptions.map((option, index) => (
                                <motion.button
                                    key={option.key}
                                    initial={{ opacity: 0, scale: 0.95 }}
                                    animate={{ opacity: 1, scale: 1 }}
                                    transition={{ delay: 0.4 + index * 0.1 }}
                                    onClick={() => setSelectedAge(option.value)}
                                    className={`w-full py-4 px-6 text-lg border rounded-xl transition-all ${
                                        selectedAge === option.value
                                            ? 'bg-primary text-primary-foreground border-primary shadow-md'
                                            : 'bg-muted/30 text-foreground border-border hover:bg-secondary/50'
                                    }`}
                                >
                                    {option.label}
                                </motion.button>
                            ))}
                        </div>

                        <motion.button
                            initial={{ opacity: 0, scale: 0.95 }}
                            animate={{ opacity: 1, scale: 1 }}
                            transition={{ delay: 0.9 }}
                            onClick={handleSubmit}
                            disabled={!selectedAge}
                            className="w-full py-4 bg-primary text-primary-foreground rounded-xl font-semibold hover:opacity-90 transition disabled:bg-muted disabled:text-muted-foreground"
                        >
                            다음
                        </motion.button>
                    </div>
                </motion.div>
            );
        }

        // Welcome Screen Component (코드 유지)
        function WelcomeScreen({ onStart, age, isSimpleMode, toggleSimpleMode }) {
            const questionOptions = [
                { count: 5, time: "2분" },
                { count: 7, time: "3분" },
                { count: 10, time: "5분" }
            ];

            const handleStart = (count) => {
                onStart(count, age, isSimpleMode);
            };

            const buttonClass = (isActive) => `
                bg-secondary/10 border border-border rounded-xl p-8 transition-all text-center group flex flex-col items-center h-full
                ${isActive ? 'hover:bg-secondary/30' : 'hover:bg-secondary/30'}
                ${isSimpleMode 
                    ? 'bg-simple-primary/50 border-simple-primary/80 hover:bg-simple-primary/70' 
                    : 'bg-secondary/10 border-border hover:bg-secondary/30'}
            `;
            
            const titleClass = (isActive) => `
                text-4xl font-extrabold mb-1 group-hover:text-primary transition
                ${isSimpleMode ? 'text-simple-foreground' : 'text-primary'}
            `;


            return (
                <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    className={`min-h-screen flex items-center justify-center p-8 ${isSimpleMode ? 'simple-mode-active' : ''}`}
                    style={{ background: isSimpleMode ? 'hsl(var(--background-simple))' : 'hsl(var(--background))' }}
                >
                    <div className="max-w-4xl w-full text-center text-foreground p-12 bg-card rounded-2xl shadow-2xl border border-border/50">
                        <motion.h1
                            initial={{ opacity: 0, y: -20 }}
                            animate={{ y: 0, opacity: 1 }}
                            transition={{ delay: 0.2 }}
                            className="text-5xl font-extrabold mb-8" 
                            style={{ color: 'hsl(var(--foreground))' }}
                        >
                            테스트 길이 선택
                        </motion.h1>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                            {questionOptions.map((option, index) => (
                                <motion.button
                                    key={option.count}
                                    initial={{ opacity: 0, scale: 0.95 }}
                                    animate={{ opacity: 1, scale: 1 }}
                                    transition={{ delay: 0.6 + index * 0.1 }}
                                    onClick={() => handleStart(option.count)} 
                                    className={buttonClass()}
                                >
                                    <div className="flex-grow">
                                        <div className={titleClass()}>
                                            {option.count}
                                        </div>
                                        <div className="text-base font-semibold text-foreground mb-3">
                                            개 질문
                                        </div>
                                    </div>
                                    <div className="text-muted-foreground text-sm font-medium px-3 py-1 bg-muted rounded-full w-fit">
                                        {option.time} 소요
                                    </div>
                                </motion.button>
                            ))}
                        </div>
                        
                        {/* --- 토글 버튼 영역 (설명 제거, 레버 강조) --- */}
                        <div className="flex items-center justify-center space-x-4 border-t border-border pt-6 mt-6">
                            <span className="text-lg font-semibold text-foreground transition-all">간편 답변 모드</span>
                            <label className="toggle-switch">
                                <input 
                                    type="checkbox" 
                                    checked={isSimpleMode} 
                                    onChange={toggleSimpleMode} 
                                />
                                <span className="toggle-slider"></span>
                            </label>
                            {/* <span className="text-sm text-muted-foreground"></span> */}
                        </div>
                        {/* ------------------ */}

                    </div>
                </motion.div>
            );
        }

        // --- Question Card Component (옵션 텍스트 추출 로직만 수정) ---
        function QuestionCard({ question, options, onAnswer, currentQuestion, totalQuestions, isSimpleMode }) {
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            const cardStyles = "p-8 rounded-xl bg-card border border-border/50 backdrop-blur-sm";

            // 옵션 목록을 텍스트만 추출
            const optionTexts = options.map(opt => opt.text || opt); 

            // 간편 답변 모드 렌더링
            if (isSimpleMode) {
                return (
                    <motion.div
                        key={currentQuestion} 
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        transition={{ duration: 0.3 }}
                        className="min-h-screen w-full flex flex-col items-center justify-between p-4 sm:p-8"
                        style={{ background: 'hsl(var(--background-simple))' }} 
                    >
                        {/* 진행바 */}
                        <div className="w-full max-w-4xl pt-4 mb-4">
                            <div className="flex justify-between text-sm text-muted-foreground mb-2">
                                <span>질문 {currentQuestion + 1}</span>
                                <span>{totalQuestions}개 중</span>
                            </div>
                            <div className="h-2 bg-muted rounded-full overflow-hidden">
                                <motion.div
                                    initial={{ width: 0 }}
                                    animate={{ width: `${progress}%` }}
                                    transition={{ duration: 0.5 }}
                                    className="h-full"
                                    style={{ backgroundColor: 'hsl(var(--primary))' }}
                                />
                            </div>
                        </div>

                        {/* 질문 영역 */}
                        <div className="max-w-4xl w-full text-center p-8 bg-card rounded-xl shadow-xl mb-4">
                            <h2 className="text-3xl sm:text-4xl font-extrabold text-foreground">
                                {question}
                            </h2>
                        </div>
                        
                        {/* 답변 버튼 (좌우 가득 채움) */}
                        <div className="w-full max-w-4xl flex flex-col sm:flex-row gap-4 flex-grow justify-center items-stretch">
                            {options.map((option, index) => (
                                <motion.button
                                    key={index}
                                    initial={{ opacity: 0, scale: 0.95 }}
                                    animate={{ opacity: 1, scale: 1 }}
                                    transition={{ delay: index * 0.1, type: "spring", stiffness: 100 }}
                                    onClick={() => onAnswer(index)} // 선택된 인덱스 전달
                                    className={`
                                        flex-1 min-h-[150px] flex flex-col items-center justify-center 
                                        text-center p-6 rounded-2xl shadow-lg transition-all duration-300
                                        hover:shadow-xl hover:scale-[1.01]
                                        ${index === 0 
                                            ? 'bg-primary/90 text-primary-foreground' 
                                            : 'bg-accent/80 text-primary-foreground'}
                                    `}
                                >
                                    <div className="text-6xl font-black mb-3 opacity-90">
                                        {String.fromCharCode(65 + index)}
                                    </div>
                                    <span className="text-lg font-semibold">{option.text || option}</span>
                                </motion.button>
                            ))}
                        </div>
                        
                        <div className="h-4"></div> {/* 하단 여백 유지 */}

                    </motion.div>
                );
            }

            // 일반 객관식 모드 렌더링
            return (
                <motion.div
                    key={currentQuestion} 
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -20 }}
                    transition={{ duration: 0.3 }}
                    className="w-full max-w-2xl mx-auto"
                >
                    <div className="mb-8">
                        <div className="flex justify-between text-sm text-muted-foreground mb-2">
                            <span>질문 {currentQuestion + 1}</span>
                            <span>{totalQuestions}개 중</span>
                        </div>
                        <div className="h-2 bg-muted rounded-full overflow-hidden">
                            <motion.div
                                initial={{ width: 0 }}
                                animate={{ width: `${progress}%` }}
                                transition={{ duration: 0.5 }}
                                className="h-full"
                                style={{ backgroundColor: 'hsl(var(--primary))' }}
                            />
                        </div>
                    </div>

                    <div className={cardStyles} style={{ boxShadow: 'var(--shadow-card)' }}>
                        <h2 className="text-3xl font-bold mb-8 text-foreground">{question}</h2>
                        <div className="space-y-3">
                            {options.map((option, index) => (
                                <motion.button
                                    key={index}
                                    initial={{ opacity: 0, x: -20 }}
                                    animate={{ opacity: 1, x: 0 }}
                                    transition={{ delay: index * 0.1 }}
                                    onClick={() => onAnswer(index)} // 선택된 인덱스 전달
                                    className="w-full text-left h-auto py-4 px-6 text-lg border border-border rounded-lg hover:bg-accent/10 hover:border-accent transition-all"
                                >
                                    <span className="flex items-center gap-3">
                                        <span className="flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 text-primary flex items-center justify-center font-semibold">
                                            {String.fromCharCode(65 + index)}
                                        </span>
                                        <span>{option.text || option}</span>
                                    </span>
                                </motion.button>
                            ))}
                        </div>
                    </div>
                </motion.div>
            );
        }

        // Result Screen Component (수정된 결과 로직 적용)
        function ResultScreen({ answers, answerTimes, questions, onRestart }) { // questions prop 추가
            
            // **[핵심 수정]** 성격 태그 및 종합 결과 로직 재설계
            const getComprehensiveResult = () => {
                const totalQuestions = answers.length;
                if (totalQuestions === 0) {
                    return { 
                        resultType: "오류", 
                        emoji: "⚠️", 
                        description: "답변이 없습니다.", 
                        resultDetail: "테스트가 제대로 진행되지 않았습니다.", 
                        totalScore: 0, 
                        avgTime: 0 
                    };
                }

                // 1. 핵심 지표 계산
                const avgTime = answerTimes.reduce((a, b) => a + b, 0) / totalQuestions;
                
                // answers 배열은 이제 [tag1, tag2, tag3...] 형태로 저장됨
                const answerVariety = new Set(answers).size; 
                const varietyRatio = answerVariety / totalQuestions; 
                const consistency = 1 - varietyRatio; 
                
                // 성격 점수 계산 (E, F, T, P)
                const scores = { E: 0, F: 0, T: 0, P: 0 };
                answers.forEach(tag => {
                    if (scores.hasOwnProperty(tag)) {
                        scores[tag]++;
                    }
                });

                const sortedScores = Object.entries(scores)
                    .sort(([, a], [, b]) => b - a)
                    .filter(([, score]) => score > 0);
                
                const dominantTag = sortedScores[0]?.[0] || 'T'; // 기본값 T
                const dominantScore = sortedScores[0]?.[1] || 0;
                
                // 2. 특수 및 일반 결과 판별 (우선순위 순)
                
                let resultType = "";
                let emoji = "";
                let description = "";
                let resultDetail = "";
                
                // A. 특수 케이스 1: 1번만 누른 경우
                if (totalQuestions === 1) {
                    resultType = "성급한 시도자";
                    emoji = "❗";
                    description = "테스트를 단 한 번의 클릭으로 마친 즉흥성";
                    resultDetail = "당신은 테스트를 시작하자마자 단 한 번의 답변만 기록했습니다. 이는 호기심이 많거나, 혹은 '일단 해보자'는 즉흥적인 성향이 강함을 보여줍니다. 결과를 보기 위해 테스트를 다시 시도해보는 것을 추천합니다.";
                }
                // B. 특수 케이스 2: 절대적 확신가 (선택지가 1개로만 한정됨 - 모든 질문에 같은 성향 태그)
                else if (answerVariety === 1 && totalQuestions > 3) {
                    resultType = "절대적 확신가 (" + dominantTag + "-Dominant)";
                    emoji = "👑";
                    description = "모든 질문에 대한 일관된 선택, 확고한 신념";
                    resultDetail = `당신은 모든 질문에 ${dominantTag} 성향의 선택만 고르는 절대적인 일관성을 보였습니다. 이는 타의 추종을 불허하는 확고한 주관과 흔들리지 않는 신념을 가진 '극단적 성향의 소유자'임을 의미합니다.`;
                } 
                // C. 특수 케이스 3: 빛의 속도 판단가 (평균 답변 속도 0.5초 미만)
                else if (avgTime < 500) {
                    resultType = "빛의 속도 판단가";
                    emoji = "⚡️";
                    description = "문제와 동시에 답을 아는 초월적 반응 속도";
                    resultDetail = "당신의 평균 답변 속도는 0.5초 미만입니다! 이는 문제를 보자마자 즉각적으로 최적의 답을 선택하는 뛰어난 순발력과 직관력을 의미합니다. 고민할 필요 없이 답을 알고 있는 '타고난 결정가'입니다.";
                } 
                // D. 성향 기반 결과 (태그 조합 및 속도 적용)
                else {
                    const topTraits = sortedScores.slice(0, 2).map(([tag]) => tag).join('');
                    
                    if (dominantTag === 'F') {
                        if (avgTime < 1500) {
                            resultType = "민첩한 관계 지향가";
                            emoji = "🤝";
                            description = "빠르게 상대방의 감정을 읽고 행동하는 배려심";
                            resultDetail = "당신은 '공감/관계' 성향이 가장 강하지만, 판단 속도까지 빠릅니다. 이는 주변 사람들의 감정 상태를 빠르게 파악하고 즉각적으로 도움을 주거나 분위기를 맞추는 능력자임을 보여줍니다.";
                        } else {
                            resultType = "배려심 깊은 조언가";
                            emoji = "💖";
                            description = "모두의 행복을 위해 신중하게 선택하는 유형";
                            resultDetail = "가장 높은 점수를 받은 '공감/관계' 성향처럼, 당신은 타인의 감정이나 가치를 가장 중요하게 여깁니다. 느린 답변 속도는 관계에 해를 끼치지 않을 가장 현명한 해결책을 찾기 위한 신중함을 의미합니다.";
                        }
                    } else if (dominantTag === 'T') {
                        if (avgTime < 1500) {
                            resultType = "초효율 논리 설계자";
                            emoji = "🤖";
                            description = "신속하게 논리적 분석을 끝내는 냉철한 효율주의자";
                            resultDetail = "최고 점수인 '논리/분석' 성향과 빠른 판단 속도의 결합으로, 당신은 불필요한 감정 소모 없이 문제를 정의하고 가장 효율적인 해결책을 빠르게 도출해냅니다. 업무 및 프로젝트에서 빛을 발합니다.";
                        } else {
                            resultType = "심층 분석가";
                            emoji = "🔍";
                            description = "깊이 있는 논리적 사고로 문제의 본질을 파헤침";
                            resultDetail = "당신은 '논리/분석' 성향이 매우 강하며, 느린 답변 속도는 데이터와 정보를 철저하게 검토하는 신중함에서 나옵니다. 어떤 문제든 본질을 파악하고 정확한 결론에 도달합니다.";
                        }
                    } else if (dominantTag === 'E') {
                        if (dominantScore / totalQuestions > 0.6) {
                            resultType = "즉각적 돌파형 실행가";
                            emoji = "🚀";
                            description = "고민 없이 즉시 행동으로 옮기는 대범한 추진력";
                            resultDetail = "압도적인 '행동/외향' 성향을 보였습니다. 당신은 이론보다는 실천을, 고민보다는 경험을 중요시합니다. 빠른 실행력과 추진력으로 새로운 기회를 선점하는 타입입니다.";
                        } else {
                            resultType = "사회적 에너지 리더";
                            emoji = "🥳";
                            description = "타인과의 상호작용에서 에너지를 얻는 외향적 성향";
                            resultDetail = "강한 '행동/외향' 성향을 가졌으며, 주로 사람들과의 활동이나 새로운 경험을 통해 활력을 얻습니다. 사교성이 뛰어나고 분위기를 주도하는 리더십이 있습니다.";
                        }
                    } else if (dominantTag === 'P') {
                        if (dominantScore / totalQuestions > 0.6) {
                            resultType = "완벽주의적 체계 설계자";
                            emoji = "📐";
                            description = "미래를 예측하고 철저한 계획을 세우는 완벽주의";
                            resultDetail = "압도적인 '계획/체계' 성향을 보였습니다. 당신은 예측 가능성과 안정성을 추구하며, 모든 일에 앞서 철저한 계획과 준비를 마칩니다. 때로는 느리지만, 그 결과물은 완벽에 가깝습니다.";
                        } else {
                            resultType = "점진적 목표 달성가";
                            emoji = "🎯";
                            description = "안정적인 방식으로 목표를 향해 나아가는 끈기";
                            resultDetail = "강한 '계획/체계' 성향으로, 단기적인 충동 대신 장기적인 목표와 일정을 중요시합니다. 꾸준함과 끈기를 바탕으로 어려운 목표도 결국 달성해내는 타입입니다.";
                        }
                    } else {
                        // 모든 성향이 고르게 분산된 경우
                        resultType = "밸런스 마스터 (전략적 유연형)";
                        emoji = "⚖️";
                        description = "상황에 따라 성향을 자유자재로 바꾸는 유연성";
                        resultDetail = "당신은 특정 성향에 치우치지 않고, 모든 성향에서 고른 점수를 받았습니다. 이는 상황에 맞춰 행동, 공감, 논리, 계획 중 가장 필요한 방식을 유연하게 선택할 수 있는 '전략적 사고의 소유자'임을 의미합니다.";
                    }
                }
                
                // 3. 종합 점수 및 메타 정보
                const normalizedSpeed = Math.min(100, Math.max(0, (5000 - avgTime) / 40)); 
                const normalizedVariety = varietyRatio * 100;
                const totalScore = Math.round(normalizedSpeed * 0.5 + normalizedVariety * 0.5); 

                return { resultType, emoji, description, resultDetail, totalScore, avgTime, scores };
            };

            const result = getComprehensiveResult();
            const avgTimeSeconds = (result.avgTime / 1000).toFixed(2);

            // 성향 점수 시각화 데이터
            const scoreDisplay = [
                { tag: 'E (행동/외향)', score: result.scores.E, max: answers.length },
                { tag: 'F (공감/관계)', score: result.scores.F, max: answers.length },
                { tag: 'T (논리/분석)', score: result.scores.T, max: answers.length },
                { tag: 'P (계획/체계)', score: result.scores.P, max: answers.length },
            ].filter(item => item.max > 0); // 답변이 1개일 경우를 대비해 필터링
            
            return (
                <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5, delay: 0.5 }}
                    className="min-h-screen flex items-center justify-center p-8"
                    style={{ background: 'hsl(var(--background))' }}
                >
                    <div className="max-w-2xl w-full text-center text-foreground p-12 bg-card rounded-2xl shadow-2xl border border-border/50">
                        <motion.div
                            initial={{ scale: 0.8 }}
                            animate={{ scale: 1 }}
                            transition={{ type: "spring", stiffness: 100, delay: 0.8 }}
                            className="text-8xl mb-6"
                        >
                            {result.emoji}
                        </motion.div>

                        <h1 className="text-4xl font-extrabold mb-2 text-primary">
                            {result.resultType}
                        </h1>
                        <p className="text-2xl font-semibold mb-8 text-foreground/80">
                            {result.description}
                        </p>
                        
                        {/* --- 성향 점수 막대 그래프 표시 --- */}
                        {scoreDisplay.length > 0 && (
                            <div className="text-left mb-10 p-6 bg-secondary/30 rounded-xl border border-border/50">
                                <h3 className="text-xl font-bold mb-4 text-primary">성향 분석 상세 결과 ({answers.length}문항 기준)</h3>
                                <div className="space-y-3">
                                    {scoreDisplay.map((item, index) => {
                                        const width = (item.score / item.max) * 100;
                                        const color = (item.tag.includes('E')) ? 'bg-red-500' 
                                            : (item.tag.includes('F')) ? 'bg-green-500'
                                            : (item.tag.includes('T')) ? 'bg-blue-500'
                                            : 'bg-yellow-500';
                                        
                                        return (
                                            <div key={index}>
                                                <div className="flex justify-between items-center mb-1 text-sm font-medium text-foreground">
                                                    <span>{item.tag}</span>
                                                    <span>{item.score}회 ({width.toFixed(0)}%)</span>
                                                </div>
                                                <div className="w-full h-3 bg-muted rounded-full overflow-hidden">
                                                    <div 
                                                        className={`h-full ${color} transition-all duration-700`} 
                                                        style={{ width: `${width}%` }}
                                                    ></div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}
                        {/* ---------------------------------- */}
                        
                        <div className="text-left mb-10 p-6 bg-muted/50 rounded-xl border border-border">
                            <h3 className="text-xl font-bold mb-3 text-primary">종합 해석</h3>
                            <p className="text-lg text-foreground leading-relaxed">
                                {result.resultDetail}
                            </p>
                        </div>

                        <div className="text-center text-sm text-muted-foreground mb-10">
                            <p>총 {answers.length}개 질문 답변 완료</p>
                            <p>평균 답변 속도: <span className="font-bold text-primary">{avgTimeSeconds}초</span></p>
                        </div>

                        <motion.button
                            initial={{ opacity: 0, y: 20 }}
                            animate={{ opacity: 1, y: 0 }}
                            transition={{ delay: 1.2 }}
                            onClick={onRestart}
                            className="w-full py-4 bg-primary text-primary-foreground rounded-xl font-semibold hover:opacity-90 transition"
                        >
                            다시 시작하기
                        </motion.button>
                    </div>
                </motion.div>
            );
        }

        // --- 메인 앱 컴포넌트 (답변 로직 수정) ---
        function QuizApp() {
            const [stage, setStage] = useState('ageInput'); 
            const [age, setAge] = useState(null);
            const [questions, setQuestions] = useState([]);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [answers, setAnswers] = useState([]); // 이제 태그(tag)를 저장
            const [answerTimes, setAnswerTimes] = useState([]);
            const [startTime, setStartTime] = useState(null);
            const [isSimpleMode, setIsSimpleMode] = useState(false);
            const quizStartTimeRef = useRef(null); 

            const handleAgeSubmit = (selectedAge) => {
                setAge(selectedAge);
                setStage('welcome');
            };

            const toggleSimpleMode = () => {
                setIsSimpleMode(prev => !prev);
            };

            const handleStartQuiz = (count, selectedAge, simpleMode) => {
                let selectedQuestions = [];
                if (simpleMode) {
                    selectedQuestions = getSimpleQuestions(count);
                } else {
                    selectedQuestions = getQuestionsByAge(selectedAge, count);
                }
                
                setQuestions(selectedQuestions);
                setAnswers([]);
                setAnswerTimes([]);
                setCurrentQuestion(0);
                setStage('quiz');
                quizStartTimeRef.current = Date.now();
                setStartTime(Date.now());
            };

            // **[핵심 수정]** 답변 시 선택 인덱스를 받아 태그를 기록
            const handleAnswer = (optionIndex) => {
                const answerTime = Date.now() - startTime;
                
                const currentQuestionObj = questions[currentQuestion];
                const selectedTag = currentQuestionObj.options[optionIndex].tag; // 태그 추출

                setAnswers([...answers, selectedTag]); // 태그를 answers 배열에 저장
                setAnswerTimes([...answerTimes, answerTime]);

                if (currentQuestion < questions.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                    setStartTime(Date.now()); 
                } else {
                    setStage('result');
                }
            };
            
            // 초기화 함수
            const handleRestart = () => {
                setStage('ageInput');
                setAge(null);
                setQuestions([]);
                setAnswers([]);
                setAnswerTimes([]);
                setCurrentQuestion(0);
                setStartTime(null);
                quizStartTimeRef.current = null;
                setIsSimpleMode(false); // 간편 모드 초기화
            };

            const renderContent = () => {
                switch (stage) {
                    case 'ageInput':
                        return <AgeInputScreen onAgeSubmit={handleAgeSubmit} />;
                    case 'welcome':
                        return <WelcomeScreen onStart={handleStartQuiz} age={age} isSimpleMode={isSimpleMode} toggleSimpleMode={toggleSimpleMode} />;
                    case 'quiz':
                        const q = questions[currentQuestion];
                        return (
                            <div className={`min-h-screen flex items-center justify-center p-4 sm:p-8 transition-all duration-500 ${isSimpleMode ? 'simple-mode-active' : ''}`}
                                style={{ background: isSimpleMode ? 'hsl(var(--background-simple))' : 'hsl(var(--background))' }}>
                                <AnimatePresence mode="wait">
                                    <QuestionCard 
                                        key={currentQuestion}
                                        question={q.question}
                                        options={q.options} // 옵션 객체 전체 전달 (태그 포함)
                                        onAnswer={handleAnswer}
                                        currentQuestion={currentQuestion}
                                        totalQuestions={questions.length}
                                        isSimpleMode={isSimpleMode}
                                    />
                                </AnimatePresence>
                            </div>
                        );
                    case 'result':
                        return <ResultScreen 
                                answers={answers} 
                                answerTimes={answerTimes} 
                                questions={questions} // 질문 목록 전달
                                onRestart={handleRestart} 
                            />;
                    default:
                        return null;
                }
            };

            return (
                <AnimatePresence mode="wait">
                    {/* 1. 돌아가기 버튼 (나이 선택 화면일 때) */}
                    {stage === 'ageInput' && (
                        <motion.a
                            initial={{ opacity: 0, y: -20 }}
                            animate={{ opacity: 1, y: 0 }}
                            exit={{ opacity: 0, y: -20 }}
                            transition={{ duration: 0.3 }}
                            href="https://nojeonggyun.github.io/webprogarmming/team/Project/main.html"
                            className={`
                                fixed top-4 left-4 z-50 
                                bg-card text-muted-foreground border border-border rounded-full 
                                py-2 px-4 text-sm font-semibold shadow-lg hover:bg-secondary/50 transition-colors
                            `}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline-block mr-1"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg>
                            돌아가기
                        </motion.a>
                    )}

                    {/* 2. 초기화 버튼 (나이 선택 화면이 아닐 때) */}
                    {stage !== 'ageInput' && (
                        <motion.button
                            initial={{ opacity: 0, y: -20 }}
                            animate={{ opacity: 1, y: 0 }}
                            exit={{ opacity: 0, y: -20 }}
                            transition={{ duration: 0.3 }}
                            onClick={handleRestart}
                            className={`
                                fixed top-4 left-4 z-50 
                                bg-card text-muted-foreground border border-border rounded-full 
                                py-2 px-4 text-sm font-semibold shadow-lg hover:bg-secondary/50 transition-colors
                                ${isSimpleMode ? 'bg-background-simple' : ''}
                            `}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline-block mr-1"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M3 21v-5h5"></path></svg>
                            초기화
                        </motion.button>
                    )}
                    {renderContent()}
                </AnimatePresence>
            );
        }

        ReactDOM.render(<QuizApp />, document.getElementById('root'));
    </script>
</body>
</html>

