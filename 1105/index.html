<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§ˆë¬¸ í…ŒìŠ¤íŠ¸ - ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš” (ë¯¸ë‹ˆë©€ ìµœì¢…)</title>
    <meta name="description" content="ëª‡ ê°€ì§€ ì§ˆë¬¸ì— ë‹µí•˜ê³  ë§ì¶¤í˜• ê²°ê³¼ë¥¼ ë°›ì•„ë³´ì„¸ìš”" />
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/framer-motion@11/dist/framer-motion.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --background: 195 20% 97%;
            --foreground: 195 70% 12%;
            --card: 0 0% 100%;
            --card-foreground: 195 70% 12%;
            --primary: 178 64% 48%; /* ë¯¼íŠ¸ ê³„ì—´ */
            --primary-foreground: 0 0% 100%;
            --secondary: 195 15% 88%;
            --secondary-foreground: 195 70% 12%;
            --muted: 195 15% 92%;
            --muted-foreground: 195 20% 45%;
            --accent: 178 64% 48%;
            --accent-foreground: 0 0% 100%;
            --border: 195 15% 88%;
            --radius: 0.75rem;
            /* ë¯¸ë‹ˆë©€ ì»¨ì…‰ì„ ìœ„í•´ ê·¸ë¼ë°ì´ì…˜ ëŒ€ì‹  ë‹¨ìƒ‰ ë°°ê²½ ì‚¬ìš© */
            --gradient-primary: hsl(var(--primary));
            --shadow-card: 0 10px 40px -8px hsl(195 30% 60% / 0.1);
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(var(--background))',
                        foreground: 'hsl(var(--foreground))',
                        card: 'hsl(var(--card))',
                        'card-foreground': 'hsl(var(--card-foreground))',
                        primary: 'hsl(var(--primary))',
                        'primary-foreground': 'hsl(var(--primary-foreground))',
                        secondary: 'hsl(var(--secondary))',
                        'secondary-foreground': 'hsl(var(--secondary-foreground))',
                        muted: 'hsl(var(--muted))',
                        'muted-foreground': 'hsl(var(--muted-foreground))',
                        accent: 'hsl(var(--accent))',
                        'accent-foreground': 'hsl(var(--accent-foreground))',
                        border: 'hsl(var(--border))',
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = Motion;

        // Question Pool (40 questions) - ë™ì¼
        const questionPool = [
            { question: "ì•„ì¹¨ì— ì¼ì–´ë‚¬ì„ ë•Œ ê°€ì¥ ë¨¼ì € í•˜ëŠ” ì¼ì€?", options: ["SNS í™•ì¸", "ìŠ¤íŠ¸ë ˆì¹­", "ë¬¼ ë§ˆì‹œê¸°", "ì¹¨ëŒ€ì—ì„œ 5ë¶„ ë”"] },
            { question: "ì£¼ë§ ì•„ì¹¨, ì´ìƒì ì¸ ì‹œê°„ì€?", options: ["7ì‹œ ì´ì „", "8-9ì‹œ", "10-11ì‹œ", "ì •ì˜¤ ì´í›„"] },
            { question: "ì—¬í–‰ ê³„íšì„ ì„¸ìš¸ ë•Œ ë‹¹ì‹ ì€?", options: ["ì„¸ì„¸í•œ ì¼ì •í‘œ ì‘ì„±", "í° í‹€ë§Œ ì •í•¨", "ì¦‰í¥ì ìœ¼ë¡œ", "ë‹¤ë¥¸ ì‚¬ëŒ ë”°ë¼ê°"] },
            { question: "ì¹œêµ¬ê°€ ê³ ë¯¼ ìƒë‹´ì„ í•œë‹¤ë©´?", options: ["í•´ê²°ì±… ì œì‹œ", "ê³µê°í•˜ë©° ë“¤ì–´ì¤Œ", "ê²½í—˜ë‹´ ê³µìœ ", "ê°™ì´ ê³ ë¯¼"] },
            { question: "ìƒˆë¡œìš´ ì·¨ë¯¸ë¥¼ ì‹œì‘í•œë‹¤ë©´?", options: ["ìš´ë™", "ì˜ˆìˆ /ê³µì˜ˆ", "ìš”ë¦¬", "ë…ì„œ"] },
            { question: "ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ë°©ë²•ì€?", options: ["ìš´ë™", "ìŒì•… ê°ìƒ", "ì ", "ì‡¼í•‘"] },
            { question: "ì„ í˜¸í•˜ëŠ” ì˜í™” ì¥ë¥´ëŠ”?", options: ["ì•¡ì…˜", "ë¡œë§¨ìŠ¤", "ìŠ¤ë¦´ëŸ¬", "ì½”ë¯¸ë””"] },
            { question: "ì¹´í˜ì—ì„œ ì£¼ë¡œ ì£¼ë¬¸í•˜ëŠ” ê²ƒì€?", options: ["ì•„ë©”ë¦¬ì¹´ë…¸", "ë¼ë–¼", "ì°¨", "ë””ì €íŠ¸ ì¤‘ì‹¬"] },
            { question: "íšŒì˜ ì¤‘ ë‹¹ì‹ ì˜ ì—­í• ì€?", options: ["ë¦¬ë”", "ì•„ì´ë””ì–´ ì œê³µ", "ê²½ì²­", "ê¸°ë¡"] },
            { question: "ê°‘ìê¸° ìƒê¸´ ììœ  ì‹œê°„, ë¬´ì—‡ì„ í• ê¹Œ?", options: ["ê³„íší–ˆë˜ ì¼", "íœ´ì‹", "ì¹œêµ¬ ë§Œë‚¨", "ìƒˆë¡œìš´ ê²ƒ ì‹œë„"] },
            { question: "ì„ ë¬¼ì„ ê³ ë¥¼ ë•Œ ì¤‘ìš”í•œ ê²ƒì€?", options: ["ì‹¤ìš©ì„±", "ë””ìì¸", "ê°€ê²©", "ì˜ë¯¸"] },
            { question: "ì¢‹ì•„í•˜ëŠ” ê³„ì ˆì€?", options: ["ë´„", "ì—¬ë¦„", "ê°€ì„", "ê²¨ìš¸"] },
            { question: "SNS ì‚¬ìš© íŒ¨í„´ì€?", options: ["ìì£¼ ì˜¬ë¦¼", "ë³´ê¸°ë§Œ í•¨", "ê°€ë” ì˜¬ë¦¼", "ê±°ì˜ ì•ˆí•¨"] },
            { question: "ìŒì•…ì„ ë“¤ì„ ë•Œ ì„ í˜¸í•˜ëŠ” ë°©ì‹ì€?", options: ["í”Œë ˆì´ë¦¬ìŠ¤íŠ¸", "ëœë¤", "ì•¨ë²” ì „ì²´", "ë¼ë””ì˜¤"] },
            { question: "ì±…ì„ ì½ì„ ë•Œ ì„ í˜¸í•˜ëŠ” ì¥ë¥´ëŠ”?", options: ["ì†Œì„¤", "ìê¸°ê³„ë°œ", "ì—ì„¸ì´", "ì „ë¬¸ì„œì "] },
            { question: "ì €ë… ì‹ì‚¬ ë©”ë‰´ ê²°ì •ì€?", options: ["ë¯¸ë¦¬ ê³„íš", "ê·¸ë•Œê·¸ë•Œ", "ë§›ì§‘ ê²€ìƒ‰", "ë°°ë‹¬ì•± íƒìƒ‰"] },
            { question: "ìƒˆë¡œìš´ ì‚¬ëŒì„ ë§Œë‚  ë•Œ?", options: ["ì ê·¹ì ìœ¼ë¡œ ë‹¤ê°€ê°", "ìƒëŒ€ ë°˜ì‘ ë³´ê³ ", "ì†Œê·¹ì ", "í”¼í•¨"] },
            { question: "ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì€?", options: ["ë§ˆê° ì „ ë¯¸ë¦¬", "ë§ˆê° ì§ì „", "ì¡°ê¸ˆì”© ë¶„ì‚°", "ëª°ì•„ì„œ"] },
            { question: "ì„ í˜¸í•˜ëŠ” ìš´ë™ ë°©ì‹ì€?", options: ["í˜¼ì ì¡°ê¹…", "íŒ€ ìŠ¤í¬ì¸ ", "í—¬ìŠ¤", "ìš´ë™ ì•ˆí•¨"] },
            { question: "íŒ¨ì…˜ ìŠ¤íƒ€ì¼ì€?", options: ["ë¯¸ë‹ˆë©€", "íŠ¸ë Œë””", "í¸ì•ˆí•¨ ìš°ì„ ", "ê°œì„± ìˆê²Œ"] },
            { question: "ë…¼ìŸ ìƒí™©ì—ì„œ ë‹¹ì‹ ì€?", options: ["ë…¼ë¦¬ì  ì„¤ë“", "ê°ì • í˜¸ì†Œ", "íšŒí”¼", "ì¤‘ì¬"] },
            { question: "ì‹¤íŒ¨í–ˆì„ ë•Œ ë°˜ì‘ì€?", options: ["ì›ì¸ ë¶„ì„", "ê°ì • í† ë¡œ", "ë¹¨ë¦¬ ìŠìŒ", "ë‹¤ì‹œ ë„ì „"] },
            { question: "ëˆ ê´€ë¦¬ ë°©ì‹ì€?", options: ["ê¼¼ê¼¼íˆ ê¸°ë¡", "ëŒ€ëµ íŒŒì•…", "ì“°ê³  ì‹¶ì„ ë•Œ", "ì €ì¶• ìš°ì„ "] },
            { question: "ì§‘ì—ì„œ ë³´ë‚´ëŠ” ì‹œê°„?", options: ["ìƒì‚°ì  í™œë™", "íœ´ì‹/ìˆ˜ë©´", "ì·¨ë¯¸", "ì²­ì†Œ/ì •ë¦¬"] },
            { question: "ì¢‹ì•„í•˜ëŠ” ìƒ‰ìƒì€?", options: ["íŒŒë‘", "ë¹¨ê°•", "ì´ˆë¡", "ë…¸ë‘"] },
            { question: "ì•„ì¹¨ ì‹ì‚¬ ìŠ¤íƒ€ì¼ì€?", options: ["ë“ ë“ í•˜ê²Œ", "ê°„ë‹¨í•˜ê²Œ", "ì»¤í”¼ë§Œ", "ì•ˆë¨¹ìŒ"] },
            { question: "ì „í™”ì™€ ë¬¸ì ì¤‘ ì„ í˜¸ëŠ”?", options: ["ì „í™”", "ë¬¸ì", "ìƒí™©ë”°ë¼", "ë‘˜ ë‹¤ ì‹«ìŒ"] },
            { question: "ì§‘ ì¸í…Œë¦¬ì–´ ìŠ¤íƒ€ì¼ì€?", options: ["ëª¨ë˜", "ë¹ˆí‹°ì§€", "ë¯¸ë‹ˆë©€", "ì•„ëŠ‘í•¨"] },
            { question: "íŒŒí‹°ì—ì„œ ë‹¹ì‹ ì€?", options: ["ë¶„ìœ„ê¸° ì£¼ë„", "ì¹œí•œ ì‚¬ëŒê³¼", "ì¡°ìš©íˆ ê´€ì°°", "ì¼ì° í‡´ì¥"] },
            { question: "í•™ìŠµ ë°©ì‹ì€?", options: ["ì´ë¡  ë¨¼ì €", "ì‹¤ìŠµ ì¤‘ì‹¬", "í† ë¡ ", "ë…í•™"] },
            { question: "ë‚ ì”¨ê°€ ì¢‹ì€ ì£¼ë§ì—”?", options: ["ì•¼ì™¸ í™œë™", "ì§‘ì—ì„œ íœ´ì‹", "ì¹´í˜", "ë¬¸í™”ìƒí™œ"] },
            { question: "ì¤‘ìš”í•œ ê²°ì •ì„ í•  ë•Œ?", options: ["ë¶„ì„ í›„ ê²°ì •", "ì§ê°", "ì¡°ì–¸ êµ¬í•¨", "ë¯¸ë£¸"] },
            { question: "ì„ í˜¸í•˜ëŠ” ì—¬í–‰ ìŠ¤íƒ€ì¼ì€?", options: ["ê³„íší˜• ê´€ê´‘", "ììœ ì—¬í–‰", "íœ´ì–‘", "ëª¨í—˜"] },
            { question: "íŒ€ í”„ë¡œì íŠ¸ì—ì„œ ì—­í• ì€?", options: ["ê¸°íš", "ì‹¤í–‰", "ì¡°ìœ¨", "ë§ˆë¬´ë¦¬"] },
            { question: "ê°ˆë“± í•´ê²° ë°©ì‹ì€?", options: ["ëŒ€í™”", "ì‹œê°„ì´ í•´ê²°", "ì œ3ì ê°œì…", "íšŒí”¼"] },
            { question: "ì¢‹ì•„í•˜ëŠ” ê°„ì‹ì€?", options: ["ê³¼ì", "ê³¼ì¼", "ê²¬ê³¼ë¥˜", "ì•ˆë¨¹ìŒ"] },
            { question: "ì •ë³´ ìŠµë“ ë°©ë²•ì€?", options: ["ì±…", "ì˜ìƒ", "íŒŸìºìŠ¤íŠ¸", "ê²½í—˜"] },
            { question: "ì ë“¤ê¸° ì „ ë£¨í‹´ì€?", options: ["ë…ì„œ", "ì˜ìƒ ì‹œì²­", "ëª…ìƒ", "ìŠ¤ë§ˆíŠ¸í°"] },
            { question: "ëª©í‘œ ì„¤ì • ë°©ì‹ì€?", options: ["êµ¬ì²´ì  ê³„íš", "í° ê·¸ë¦¼", "ë‹¨ê¸° ëª©í‘œ", "ëª©í‘œ ì—†ìŒ"] },
            { question: "ì—ë„ˆì§€ ì¶©ì „ ë°©ë²•ì€?", options: ["ì‚¬ëŒë“¤ê³¼", "í˜¼ì", "í™œë™ì ìœ¼ë¡œ", "íœ´ì‹"] }
        ];

        function getRandomQuestions(count) {
            const shuffled = [...questionPool].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        function getMiniGamePositions(totalQuestions) {
            if (totalQuestions === 5) return [2];
            if (totalQuestions === 7) return [3, 5];
            if (totalQuestions === 10) return [3, 6, 8];
            return [];
        }

        // Welcome Screen Component (ìµœì¢… ê°œì„ : ê¸€ì í¬ê¸° ì¶•ì†Œ ë° ê³µê°„ê° í™•ë³´)
        function WelcomeScreen({ onStart }) {
            const questionOptions = [
                { count: 5, time: "2ë¶„" },
                { count: 7, time: "3ë¶„" },
                { count: 10, time: "5ë¶„" }
            ];

            return (
                <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    className="min-h-screen flex items-center justify-center p-8" // p-8ë¡œ ì—¬ë°± ëŠ˜ë¦¼
                    style={{ background: 'hsl(var(--background))' }}
                >
                    <div className="max-w-4xl w-full text-center text-foreground p-12 bg-card rounded-2xl shadow-2xl border border-border/50"> {/* p-12ë¡œ ì¹´ë“œ ë‚´ë¶€ ì—¬ë°± ëŠ˜ë¦¼ */}
                        <motion.h1
                            initial={{ opacity: 0, y: -20 }}
                            animate={{ opacity: 1, y: 0 }}
                            transition={{ delay: 0.2 }}
                            // ê¸€ì í¬ê¸° ì¶•ì†Œ (7xl -> 5xl)
                            className="text-5xl font-extrabold mb-3" 
                            style={{ color: 'hsl(var(--foreground))' }} // ëœ íŠ€ëŠ” ìƒ‰ìƒ
                        >
                            ì§ˆë¬¸ í…ŒìŠ¤íŠ¸
                        </motion.h1>
                        <motion.p
                            initial={{ opacity: 0 }}
                            animate={{ opacity: 1 }}
                            transition={{ delay: 0.4 }}
                            // ê¸€ì í¬ê¸° ì¶•ì†Œ (xl -> lg) ë° ë§ˆì§„ ì¶•ì†Œ (mb-12 -> mb-8)
                            className="text-lg mb-8 text-muted-foreground"
                        >
                            í…ŒìŠ¤íŠ¸ ê¸¸ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”.
                        </motion.p>
                        
                        {/* ì„ íƒì§€ ì˜ì—­ */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> {/* gap-4 -> gap-6ìœ¼ë¡œ ê°„ê²© ëŠ˜ë¦¼ */}
                            {questionOptions.map((option, index) => (
                                <motion.button
                                    key={option.count}
                                    initial={{ opacity: 0, scale: 0.95 }} // ì´ˆê¸° ìŠ¤ì¼€ì¼ ì¡°ì •
                                    animate={{ opacity: 1, scale: 1 }}
                                    transition={{ delay: 0.6 + index * 0.1 }}
                                    onClick={() => onStart(option.count)}
                                    // p-6 -> p-8ë¡œ ë²„íŠ¼ ë‚´ë¶€ ì—¬ë°± ëŠ˜ë¦¼, hover íš¨ê³¼ ë³€ê²½
                                    className="bg-secondary/10 border border-border rounded-xl p-8 hover:bg-secondary/30 transition-all text-center group flex flex-col items-center h-full"
                                >
                                    <div className="flex-grow">
                                        {/* ì§ˆë¬¸ ê°œìˆ˜ ê¸€ì í¬ê¸° ì¶•ì†Œ (5xl -> 4xl) */}
                                        <div className="text-4xl font-extrabold mb-1 text-primary group-hover:text-primary transition">
                                            {option.count}
                                        </div>
                                        {/* "ê°œ ì§ˆë¬¸" ê¸€ì í¬ê¸° ì¶•ì†Œ (lg -> base) */}
                                        <div className="text-base font-semibold text-foreground mb-3">
                                            ê°œ ì§ˆë¬¸
                                        </div>
                                    </div>
                                    {/* ì†Œìš” ì‹œê°„ ë±ƒì§€ */}
                                    <div className="text-muted-foreground text-sm font-medium px-3 py-1 bg-muted rounded-full w-fit">
                                        {option.time} ì†Œìš”
                                    </div>
                                </motion.button>
                            ))}
                        </div>
                    </div>
                </motion.div>
            );
        }

        // Question Card Component - ë™ì¼
        function QuestionCard({ question, options, onAnswer, currentQuestion, totalQuestions }) {
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;

            return (
                <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -20 }}
                    transition={{ duration: 0.3 }}
                    className="w-full max-w-2xl mx-auto"
                >
                    <div className="mb-8">
                        <div className="flex justify-between text-sm text-muted-foreground mb-2">
                            <span>ì§ˆë¬¸ {currentQuestion + 1}</span>
                            <span>{totalQuestions}ê°œ ì¤‘</span>
                        </div>
                        <div className="h-2 bg-muted rounded-full overflow-hidden">
                            <motion.div
                                initial={{ width: 0 }}
                                animate={{ width: `${progress}%` }}
                                transition={{ duration: 0.5 }}
                                className="h-full"
                                style={{ backgroundColor: 'hsl(var(--primary))' }}
                            />
                        </div>
                    </div>

                    <div className="p-8 rounded-xl bg-card border border-border/50 backdrop-blur-sm" style={{ boxShadow: 'var(--shadow-card)' }}>
                        <h2 className="text-3xl font-bold mb-8 text-foreground">{question}</h2>
                        <div className="space-y-3">
                            {options.map((option, index) => (
                                <motion.button
                                    key={index}
                                    initial={{ opacity: 0, x: -20 }}
                                    animate={{ opacity: 1, x: 0 }}
                                    transition={{ delay: index * 0.1 }}
                                    onClick={() => onAnswer(option)}
                                    className="w-full text-left h-auto py-4 px-6 text-lg border border-border rounded-lg hover:bg-accent/10 hover:border-accent transition-all"
                                >
                                    <span className="flex items-center gap-3">
                                        <span className="flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 text-primary flex items-center justify-center font-semibold">
                                            {String.fromCharCode(65 + index)}
                                        </span>
                                        <span>{option}</span>
                                    </span>
                                </motion.button>
                            ))}
                        </div>
                    </div>
                </motion.div>
            );
        }

        // Reaction Game Component - ë™ì¼
        function ReactionGame({ onComplete }) {
            const [stage, setStage] = useState("waiting");
            const [startTime, setStartTime] = useState(0);
            const [reactionTime, setReactionTime] = useState(0);
            const timeoutRef = useRef();

            useEffect(() => {
                if (stage === "waiting") {
                    const delay = 2000 + Math.random() * 3000;
                    timeoutRef.current = setTimeout(() => {
                        setStage("ready");
                        setTimeout(() => {
                            setStage("go");
                            setStartTime(Date.now());
                        }, 1000);
                    }, 1000);
                }

                return () => {
                    if (timeoutRef.current) clearTimeout(timeoutRef.current);
                };
            }, [stage]);

            const handleClick = () => {
                if (stage === "waiting" || stage === "ready") {
                    setStage("tooEarly");
                    setTimeout(() => onComplete(0), 2000);
                } else if (stage === "go") {
                    const time = Date.now() - startTime;
                    setReactionTime(time);
                    setStage("result");
                    const score = Math.max(0, 1000 - time);
                    setTimeout(() => onComplete(Math.round(score)), 2000);
                }
            };

            return (
                <motion.div
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.9 }}
                    className="w-full max-w-2xl mx-auto"
                >
                    <div className="p-8 rounded-xl bg-card border border-border">
                        <h2 className="text-2xl font-bold text-center mb-4">ë°˜ì‘ì†ë„ ê²Œì„</h2>
                        <p className="text-sm text-muted-foreground text-center mb-8">
                            ì´ˆë¡ìƒ‰ì´ ë³´ì´ë©´ ìµœëŒ€í•œ ë¹¨ë¦¬ í´ë¦­í•˜ì„¸ìš”!
                        </p>

                        <div
                            className={`h-96 rounded-lg flex items-center justify-center text-4xl font-bold cursor-pointer transition-colors duration-200 ${
                                stage === "waiting" ? "bg-muted/30 text-muted-foreground" :
                                stage === "ready" ? "bg-yellow-500/20 text-yellow-600" :
                                stage === "go" ? "bg-green-500 text-white" :
                                stage === "tooEarly" ? "bg-red-500/20 text-red-600" :
                                "bg-muted/30 text-primary"
                            }`}
                            onClick={handleClick}
                        >
                            {stage === "waiting" && "ëŒ€ê¸° ì¤‘..."}
                            {stage === "ready" && "ì¤€ë¹„..."}
                            {stage === "go" && "ì§€ê¸ˆ í´ë¦­!"}
                            {stage === "tooEarly" && "ë„ˆë¬´ ë¹¨ë¼ìš”! ğŸ˜…"}
                            {stage === "result" && (
                                <div className="text-center">
                                    <div className="text-5xl mb-4">âš¡</div>
                                    <div className="text-3xl">{reactionTime}ms</div>
                                    <div className="text-lg mt-2 text-muted-foreground">
                                        {reactionTime < 300 ? "ì—„ì²­ ë¹ ë¥´ë„¤ìš”!" :
                                         reactionTime < 500 ? "ì¢‹ì•„ìš”!" :
                                         "ê´œì°®ì•„ìš”!"}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </motion.div>
            );
        }

        // Timing Game Component - ë™ì¼
        function TimingGame({ onComplete }) {
            const [position, setPosition] = useState(0);
            const [direction, setDirection] = useState(1);
            const [stopped, setStopped] = useState(false);
            const [score, setScore] = useState(0);

            useEffect(() => {
                if (stopped) return;
                const interval = setInterval(() => {
                    setPosition(prev => {
                        const next = prev + direction * 2;
                        if (next >= 100 || next <= 0) {
                            setDirection(d => -d);
                            return prev - direction * 2;
                        }
                        return next;
                    });
                }, 20);
                return () => clearInterval(interval);
            }, [direction, stopped]);

            const handleStop = () => {
                if (stopped) return;
                setStopped(true);
                const accuracy = Math.abs(50 - position);
                const gameScore = Math.max(0, 1000 - accuracy * 20);
                setScore(Math.round(gameScore));
                setTimeout(() => onComplete(Math.round(gameScore)), 2000);
            };

            return (
                <motion.div
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    className="w-full max-w-2xl mx-auto"
                >
                    <div className="p-8 rounded-xl bg-card border border-border">
                        <h2 className="text-2xl font-bold text-center mb-4">íƒ€ì´ë° ê²Œì„</h2>
                        <p className="text-sm text-muted-foreground text-center mb-8">
                            ë§‰ëŒ€ê°€ ì¤‘ì•™ì— ì™”ì„ ë•Œ ë©ˆì¶°ë³´ì„¸ìš”!
                        </p>

                        <div className="mb-8">
                            <div className="h-20 bg-muted/30 rounded-lg relative overflow-hidden">
                                <div className="absolute inset-y-0 left-1/2 w-1 bg-primary/30 -translate-x-1/2" />
                                <div
                                    className="absolute inset-y-0 w-2 bg-primary rounded transition-all"
                                    style={{ left: `${position}%`, transform: 'translateX(-50%)' }}
                                />
                            </div>
                        </div>

                        {stopped ? (
                            <div className="text-center">
                                <div className="text-5xl mb-4">ğŸ¯</div>
                                <div className="text-3xl font-bold text-primary mb-2">{score}ì </div>
                                <div className="text-muted-foreground">
                                    {score > 800 ? "ì™„ë²½í•´ìš”!" : score > 500 ? "ì¢‹ì•„ìš”!" : "ê´œì°®ì•„ìš”!"}
                                </div>
                            </div>
                        ) : (
                            <button
                                onClick={handleStop}
                                className="w-full py-4 px-6 bg-primary text-primary-foreground rounded-lg font-semibold hover:opacity-90 transition"
                            >
                                ë©ˆì¶”ê¸° (ìŠ¤í˜ì´ìŠ¤ë°”)
                            </button>
                        )}
                    </div>
                </motion.div>
            );
        }

        // Rhythm Game Component - ë™ì¼
        function RhythmGame({ onComplete }) {
            const [notes, setNotes] = useState([]);
            const [score, setScore] = useState(0);
            const [combo, setCombo] = useState(0);
            const [gameTime, setGameTime] = useState(10);
            const [feedback, setFeedback] = useState("");
            const noteIdRef = useRef(0);
            const gameStartTime = useRef(Date.now());

            useEffect(() => {
                const noteInterval = setInterval(() => {
                    if (gameTime > 0) {
                        setNotes(prev => [...prev, {
                            id: noteIdRef.current++,
                            position: 0,
                            hit: false
                        }]);
                    }
                }, 800);

                const timeInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - gameStartTime.current) / 1000);
                    const remaining = Math.max(0, 10 - elapsed);
                    setGameTime(remaining);
                    if (remaining === 0) {
                        setTimeout(() => onComplete(score), 1000);
                    }
                }, 100);

                return () => {
                    clearInterval(noteInterval);
                    clearInterval(timeInterval);
                };
            }, [score, gameTime]);

            useEffect(() => {
                const moveInterval = setInterval(() => {
                    setNotes(prev => prev
                        .map(note => ({ ...note, position: note.position + 2 }))
                        .filter(note => note.position < 105)
                    );
                }, 20);
                return () => clearInterval(moveInterval);
            }, []);

            useEffect(() => {
                const handleKeyPress = (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        checkHit();
                    }
                };
                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [notes]);

            const checkHit = () => {
                const targetZone = 85;
                const hitNote = notes.find(note => 
                    !note.hit && Math.abs(note.position - targetZone) < 15
                );

                if (hitNote) {
                    const accuracy = Math.abs(hitNote.position - targetZone);
                    let points = 0;
                    let feedbackText = "";

                    if (accuracy < 5) {
                        points = 100;
                        feedbackText = "Perfect!";
                    } else if (accuracy < 10) {
                        points = 50;
                        feedbackText = "Good!";
                    } else {
                        points = 25;
                        feedbackText = "OK";
                    }

                    setScore(prev => prev + points * (combo + 1));
                    setCombo(prev => prev + 1);
                    setFeedback(feedbackText);
                    setNotes(prev => prev.map(n => n.id === hitNote.id ? { ...n, hit: true } : n));
                } else {
                    setCombo(0);
                    setFeedback("Miss!");
                }

                setTimeout(() => setFeedback(""), 500);
            };

            return (
                <motion.div
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    className="w-full max-w-2xl mx-auto"
                >
                    <div className="p-8 rounded-xl bg-card border border-border">
                        <div className="flex justify-between mb-4">
                            <div>
                                <div className="text-sm text-muted-foreground">Score</div>
                                <div className="text-2xl font-bold text-primary">{score}</div>
                            </div>
                            <div className="text-right">
                                <div className="text-sm text-muted-foreground">Time</div>
                                <div className="text-2xl font-bold">{gameTime}s}</div>
                            </div>
                        </div>

                        <div className="h-96 bg-muted/30 rounded-lg relative overflow-hidden mb-4">
                            <div className="absolute bottom-20 left-0 right-0 h-2 bg-primary/50" />
                            {notes.map(note => (
                                <div
                                    key={note.id}
                                    className={`absolute left-1/2 w-16 h-4 rounded-full -translate-x-1/2 transition-opacity ${
                                        note.hit ? 'bg-green-500 opacity-0' : 'bg-primary'
                                    }`}
                                    style={{ bottom: `${note.position}%` }}
                                />
                            ))}
                            {feedback && (
                                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-4xl font-bold text-primary">
                                    {feedback}
                                </div>
                            )}
                        </div>

                        <div className="text-center text-sm text-muted-foreground">
                            ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ ë…¸íŠ¸ë¥¼ ë§ì¶°ë³´ì„¸ìš”! Combo: {combo}
                        </div>
                    </div>
                </motion.div>
            );
        }

        // Result Screen Component - ë™ì¼
        function ResultScreen({ answers, answerTimes, miniGameScores, onRestart }) {
            const analyzeAnswerPattern = () => {
                const firstAnswer = answers[0];
                const allSame = answers.every(a => a === firstAnswer);
                const avgTime = answerTimes.reduce((a, b) => a + b, 0) / answerTimes.length;
                return { allSame, tooFast: avgTime < 1000 };
            };

            const getComprehensiveResult = () => {
                const avgTime = answerTimes.reduce((a, b) => a + b, 0) / answerTimes.length;
                const speedScore = Math.max(0, 5000 - avgTime) / 50;
                const miniGameTotal = miniGameScores.reduce((a, b) => a + b, 0);
                const miniGameAvg = miniGameTotal / miniGameScores.length;
                
                const answerVariety = new Set(answers).size;
                const varietyScore = (answerVariety / answers.length) * 1000;
                
                const totalScore = Math.round(speedScore + miniGameAvg + varietyScore);
                
                let resultType = "";
                let emoji = "";
                let description = "";
                let resultDetail = "";
                
                if (totalScore > 2000 && avgTime < 3000) {
                    resultType = "ì™„ë²½ì£¼ì˜ ë‹¬ì„±ì";
                    emoji = "ğŸ†";
                    description = "ë¹ ë¥´ê³  ì •í™•í•œ íŒë‹¨ë ¥ì˜ ì†Œìœ ì";
                    resultDetail = "ë‹¹ì‹ ì€ ì‹ ì†í•œ ì˜ì‚¬ê²°ì •ê³¼ ë†’ì€ ì§‘ì¤‘ë ¥ì„ ë™ì‹œì— ë³´ì—¬ì£¼ëŠ” ì™„ë²½ì£¼ì˜ìì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ê³¼ì œë¥¼ ë¹ ë¥´ê²Œ íŒŒì•…í•˜ê³  ì •í™•í•˜ê²Œ ìˆ˜í–‰í•˜ëŠ” ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ë©°, ê²Œì„ì—ì„œë„ ë†’ì€ ì„±ì·¨ë¥¼ ë³´ì˜€ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì„±í–¥ì€ ì••ë°• ìƒí™©ì—ì„œë„ ëƒ‰ì •í•¨ì„ ìœ ì§€í•˜ê³  ìµœì„ ì˜ ê²°ê³¼ë¥¼ ë„ì¶œí•˜ëŠ” ê°•ì ìœ¼ë¡œ ì‘ìš©í•©ë‹ˆë‹¤.";
                } else if (totalScore > 1500) {
                    resultType = "ë°¸ëŸ°ìŠ¤ ë§ˆìŠ¤í„°";
                    emoji = "âš–ï¸";
                    description = "ì†ë„ì™€ ì‹ ì¤‘í•¨ì˜ ì™„ë²½í•œ ì¡°í™”";
                    resultDetail = "ë‹¹ì‹ ì€ ë¹ ë¥¸ íŒë‹¨ê³¼ ì‹ ì¤‘í•œ ì‚¬ê³  ì‚¬ì´ì—ì„œ ì´ìƒì ì¸ ê· í˜•ì„ ìœ ì§€í•©ë‹ˆë‹¤. í•„ìš”í•  ë•ŒëŠ” ë¹ ë¥´ê²Œ ê²°ì •í•˜ì§€ë§Œ, ì¤‘ìš”í•œ ìˆœê°„ì—ëŠ” ì¶©ë¶„íˆ ê³ ë¯¼í•˜ëŠ” ì§€í˜œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ ì„ íƒì„ ê³ ë ¤í•˜ë©´ì„œë„ ìš°ìœ ë¶€ë‹¨í•˜ì§€ ì•Šì€ ë‹¹ì‹ ì˜ íƒœë„ëŠ” íŒ€ì›Œí¬ì™€ ë¦¬ë”ì‹­ ìƒí™©ì—ì„œ ë¹›ì„ ë°œí•©ë‹ˆë‹¤.";
                } else if (avgTime > 5000) {
                    resultType = "ì‹ ì¤‘í•œ ì‚¬ìƒ‰ê°€";
                    emoji = "ğŸ¤”";
                    description = "ê¹Šì´ ìˆëŠ” ê³ ë¯¼ì„ í†µí•œ í˜„ëª…í•œ ì„ íƒ";
                    resultDetail = "ë‹¹ì‹ ì€ ëª¨ë“  ì§ˆë¬¸ì— ì¶©ë¶„í•œ ì‹œê°„ì„ ë“¤ì—¬ ê¹Šì´ ìƒê°í•˜ëŠ” ì‚¬ìƒ‰ê°€ì…ë‹ˆë‹¤. ì„±ê¸‰í•œ íŒë‹¨ë³´ë‹¤ëŠ” ì‹ ì¤‘í•œ ê³ ë ¤ë¥¼ ì¤‘ìš”ì‹œí•˜ë©°, ê° ì„ íƒì˜ ì˜ë¯¸ë¥¼ ë˜ìƒˆê¸°ë©° ë‹µí•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì„±í–¥ì€ ì¥ê¸°ì  ê´€ì ì—ì„œ í˜„ëª…í•œ ê²°ì •ì„ ë‚´ë¦¬ëŠ” ë° í° ë„ì›€ì´ ë˜ë©°, ë³µì¡í•œ ë¬¸ì œ í•´ê²°ì—ì„œ íƒì›”í•œ ëŠ¥ë ¥ì„ ë°œíœ˜í•©ë‹ˆë‹¤.";
                } else if (answerVariety > answers.length * 0.7) {
                    resultType = "ììœ ë¡œìš´ íƒí—˜ê°€";
                    emoji = "ğŸŒŸ";
                    description = "ë‹¤ì–‘ì„±ì„ ì¶”êµ¬í•˜ëŠ” ëª¨í—˜ê°€";
                    resultDetail = "ë‹¹ì‹ ì€ í¸ê²¬ ì—†ì´ ëª¨ë“  ê°€ëŠ¥ì„±ì„ íƒìƒ‰í•˜ëŠ” ììœ ë¡œìš´ ì˜í˜¼ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ì„ íƒì§€ë¥¼ ê³¨ê³ ë£¨ ê³ ë ¤í•˜ë©°, íŠ¹ì • íŒ¨í„´ì— ê°‡íˆì§€ ì•ŠëŠ” ìœ ì—°í•œ ì‚¬ê³ ë°©ì‹ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê°œë°©ì  íƒœë„ëŠ” ì°½ì˜ì  ë¬¸ì œ í•´ê²°ê³¼ ìƒˆë¡œìš´ ì•„ì´ë””ì–´ ë°œêµ´ì— í° ê°•ì ì´ ë˜ë©°, ë³€í™”ì™€ í˜ì‹ ì„ ë‘ë ¤ì›Œí•˜ì§€ ì•ŠëŠ” ë‹¹ì‹ ì˜ íŠ¹ì„±ì„ ì˜ ë³´ì—¬ì¤ë‹ˆë‹¤.";
                } else {
                    resultType = "ë§ˆì´ì›¨ì´ ë„ì „ì";
                    emoji = "ğŸ’ª";
                    description = "ìì‹ ë§Œì˜ ê¸¸ì„ ê±·ëŠ” ë…ë¦½ì ì¸ ì„±í–¥";
                    resultDetail = "ë‹¹ì‹ ì€ ë‚¨ë“¤ì˜ ì‹œì„ ì´ë‚˜ ì¼ë°˜ì ì¸ ê¸°ì¤€ë³´ë‹¤ ìì‹ ë§Œì˜ ë°©ì‹ì„ ì¤‘ìš”ì‹œí•©ë‹ˆë‹¤. ë•Œë¡œëŠ” ì˜ˆìƒ ë°–ì˜ ì„ íƒì„ í•˜ê³ , ìì‹ ë§Œì˜ ë¦¬ë“¬ìœ¼ë¡œ ë¬¸ì œì— ì ‘ê·¼í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë…ë¦½ì  ì„±í–¥ì€ ê¸°ì¡´ì˜ í‹€ì„ ë²—ì–´ë‚œ í˜ì‹ ì ì¸ í•´ê²°ì±…ì„ ì°¾ì•„ë‚´ëŠ” ì›ë™ë ¥ì´ ë˜ë©°, ìì‹ ë§Œì˜ í™•ê³ í•œ ê°€ì¹˜ê´€ì„ ë°”íƒ•ìœ¼ë¡œ ì¼ê´€ëœ ì‚¶ì˜ íƒœë„ë¥¼ ìœ ì§€í•˜ê²Œ í•©ë‹ˆë‹¤.";
                }
                
                return { resultType, emoji, description, resultDetail, totalScore, avgTime, miniGameAvg };
            };

            const pattern = analyzeAnswerPattern();
            const result = getComprehensiveResult();

            if (pattern.allSame || pattern.tooFast) {
                return (
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="min-h-screen flex items-center justify-center p-4"
                    >
                        <div className="max-w-2xl w-full p-8 rounded-xl bg-card border border-border text-center">
                            <div className="text-6xl mb-4">ğŸ¤¨</div>
                            <h2 className="text-3xl font-bold mb-4 text-foreground">ì ê¹ë§Œìš”!</h2>
                            <p className="text-lg text-muted-foreground mb-8">
                                {pattern.allSame 
                                    ? "ëª¨ë“  ë‹µë³€ì´ ë™ì¼í•©ë‹ˆë‹¤. ì¡°ê¸ˆ ë” ì§„ì§€í•˜ê²Œ ì°¸ì—¬í•´ì£¼ì„¸ìš”!"
                                    : "ë„ˆë¬´ ë¹ ë¥´ê²Œ ë‹µë³€í•˜ì…¨ì–´ìš”. ê° ì§ˆë¬¸ì„ ì¶©ë¶„íˆ ì½ì–´ë³´ì„¸ìš”!"}
                            </p>
                            <button
                                onClick={onRestart}
                                className="px-8 py-4 bg-primary text-primary-foreground rounded-lg font-semibold hover:opacity-90 transition"
                            >
                                ë‹¤ì‹œ ì‹œì‘í•˜ê¸°
                            </button>
                        </div>
                    </motion.div>
                );
            }

            return (
                <motion.div
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    className="min-h-screen flex items-center justify-center p-4"
                >
                    <div className="max-w-2xl w-full p-8 rounded-xl bg-card border border-border">
                        <div className="text-center mb-8">
                            <div className="text-6xl mb-4">{result.emoji}</div>
                            <h2 className="text-3xl font-bold mb-2 text-foreground">{result.resultType}</h2>
                            <p className="text-lg text-muted-foreground mb-4">{result.description}</p>
                            <div className="text-sm text-muted-foreground leading-relaxed mb-6 text-left bg-muted/30 p-4 rounded-lg">
                                {result.resultDetail}
                            </div>
                            <div className="text-4xl font-bold text-primary mb-2">{result.totalScore}ì </div>
                        </div>

                        <div className="space-y-4 mb-8">
                            {/* ìì„¸í•œ ê²°ê³¼ ì§€í‘œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. */}
                            <div className="flex justify-between items-center bg-muted/30 p-3 rounded-lg">
                                <span className="text-muted-foreground">í‰ê·  ì‘ë‹µ ì‹œê°„:</span>
                                <span className="font-semibold text-foreground">
                                    {result.avgTime.toFixed(0)}ms
                                </span>
                            </div>
                            <div className="flex justify-between items-center bg-muted/30 p-3 rounded-lg">
                                <span className="text-muted-foreground">ë¯¸ë‹ˆê²Œì„ í‰ê·  ì ìˆ˜:</span>
                                <span className="font-semibold text-foreground">
                                    {result.miniGameAvg.toFixed(0)}ì 
                                </span>
                            </div>
                        </div>

                        <button
                            onClick={onRestart}
                            className="w-full py-4 px-6 bg-primary text-primary-foreground rounded-lg font-semibold hover:opacity-90 transition"
                        >
                            í…ŒìŠ¤íŠ¸ ë‹¤ì‹œ ì‹œì‘
                        </button>
                    </div>
                </motion.div>
            );
        }
        
        // App Component - ë™ì¼
        function App() {
            const [gameState, setGameState] = useState('welcome'); // 'welcome', 'quiz', 'miniGame', 'result'
            const [questions, setQuestions] = useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [answers, setAnswers] = useState([]);
            const [answerTimes, setAnswerTimes] = useState([]);
            const [questionStartTime, setQuestionStartTime] = useState(0);
            const [miniGameScores, setMiniGameScores] = useState([]);
            const [totalQuestions, setTotalQuestions] = useState(0);

            const miniGamePositions = getMiniGamePositions(totalQuestions);

            const startQuiz = (count) => {
                setTotalQuestions(count);
                setQuestions(getRandomQuestions(count - miniGamePositions.length));
                setAnswers([]);
                setAnswerTimes([]);
                setMiniGameScores([]);
                setCurrentQuestionIndex(0);
                setGameState('quiz');
                setQuestionStartTime(Date.now());
            };

            const handleAnswer = (answer) => {
                const answerTime = Date.now() - questionStartTime;
                setAnswers(prev => [...prev, answer]);
                setAnswerTimes(prev => [...prev, answerTime]);

                const nextIndex = currentQuestionIndex + 1;

                if (miniGamePositions.includes(nextIndex)) {
                    setGameState('miniGame');
                    setCurrentQuestionIndex(nextIndex); // ë¯¸ë‹ˆê²Œì„ í›„ í€´ì¦ˆ ì¸ë±ìŠ¤ì— ì‚¬ìš©
                } else if (nextIndex >= totalQuestions) {
                    setGameState('result');
                } else {
                    setCurrentQuestionIndex(nextIndex);
                    setQuestionStartTime(Date.now());
                }
            };

            const handleMiniGameComplete = (score) => {
                setMiniGameScores(prev => [...prev, score]);

                const nextIndex = currentQuestionIndex + 1;

                if (nextIndex >= totalQuestions) {
                    setGameState('result');
                } else {
                    setCurrentQuestionIndex(nextIndex);
                    setGameState('quiz');
                    setQuestionStartTime(Date.now());
                }
            };

            const getMiniGameComponent = () => {
                const minigameIndex = miniGameScores.length % 3;
                if (minigameIndex === 0) return <ReactionGame onComplete={handleMiniGameComplete} />;
                if (minigameIndex === 1) return <TimingGame onComplete={handleMiniGameComplete} />;
                if (minigameIndex === 2) return <RhythmGame onComplete={handleMiniGameComplete} />;
                return null;
            };

            const questionIndexInPool = currentQuestionIndex - miniGameScores.length;

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <AnimatePresence mode="wait">
                        {gameState === 'welcome' && (
                            <WelcomeScreen key="welcome" onStart={startQuiz} />
                        )}
                        {gameState === 'quiz' && questionIndexInPool < questions.length && (
                            <QuestionCard
                                key={`question-${questionIndexInPool}`}
                                question={questions[questionIndexInPool].question}
                                options={questions[questionIndexInPool].options}
                                onAnswer={handleAnswer}
                                currentQuestion={currentQuestionIndex}
                                totalQuestions={totalQuestions}
                            />
                        )}
                        {gameState === 'miniGame' && (
                            <div key="minigame" className="w-full max-w-2xl mx-auto">
                                {getMiniGameComponent()}
                            </div>
                        )}
                        {gameState === 'result' && (
                            <ResultScreen 
                                key="result"
                                answers={answers}
                                answerTimes={answerTimes}
                                miniGameScores={miniGameScores}
                                onRestart={() => setGameState('welcome')}
                            />
                        )}
                    </AnimatePresence>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
